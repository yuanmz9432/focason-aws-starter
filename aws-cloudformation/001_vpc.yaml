AWSTemplateFormatVersion: 2010-09-09
Description: >
  Create a VPC with 2 Public Subnets and 4 Private Subnets.
  Public subnets have internet access via Internet Gateway.
  Private subnets access internet via NAT Gateway.
  All subnets are interconnected via routing.
  This template includes security groups, ALB, and service discovery.

Parameters:
  ProjectName:
    Type: String
    Default: focason-cloud
    Description: Project prefix used to name all resources

  Environment:
    Type: String
    Default: dev
    AllowedValues:
      - dev
      - staging
      - prod
    Description: Environment name (dev, staging, prod)

  VpcCIDR:
    Type: String
    Default: 10.0.0.0/16
    Description: CIDR block for the VPC

  PublicSubnet1CIDR:
    Type: String
    Default: 10.0.1.0/24
    Description: CIDR block for public subnet 1 (bastion, ALB, NAT gateway)

  PublicSubnet2CIDR:
    Type: String
    Default: 10.0.2.0/24
    Description: CIDR block for public subnet 2 (bastion, ALB, NAT gateway)

  PrivateSubnet1CIDR:
    Type: String
    Default: 10.0.3.0/24
    Description: CIDR block for private subnet 1 (ECS services)

  PrivateSubnet2CIDR:
    Type: String
    Default: 10.0.4.0/24
    Description: CIDR block for private subnet 2 (ECS services)

  PrivateSubnet3CIDR:
    Type: String
    Default: 10.0.5.0/24
    Description: CIDR block for private subnet 3 (database)

  PrivateSubnet4CIDR:
    Type: String
    Default: 10.0.6.0/24
    Description: CIDR block for private subnet 4 (database)

  # Security Parameters
  AllowedSSHCIDR:
    Type: String
    Default: 0.0.0.0/0
    Description: CIDR block allowed to SSH to bastion host (use specific IP for production)

  AllowedHTTPCIDR:
    Type: String
    Default: 0.0.0.0/0
    Description: CIDR block allowed to access HTTP/HTTPS (use specific IP for production)

  # ALB Parameters
  EnableHTTPS:
    Type: String
    Default: 'false'
    AllowedValues:
      - 'true'
      - 'false'
    Description: Enable HTTPS listener with SSL certificate

  SSLCertificateArn:
    Type: String
    Default: ''
    Description: ARN of the SSL certificate in ACM (required if EnableHTTPS is true)

  HealthCheckPath:
    Type: String
    Default: /actuator/health
    Description: Health check path for target group

  # VPC Flow Logs
  EnableVPCFlowLogs:
    Type: String
    Default: 'true'
    AllowedValues:
      - 'true'
      - 'false'
    Description: Enable VPC Flow Logs for network monitoring

Conditions:
  IsProd:
    Fn::Equals:
      - !Ref Environment
      - prod

  EnableHTTPSListener:
    Fn::Equals:
      - !Ref EnableHTTPS
      - 'true'

  CreateFlowLogs:
    Fn::Equals:
      - !Ref EnableVPCFlowLogs
      - 'true'

Resources:
  # -----------------------
  # VPC
  # -----------------------
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: !Ref VpcCIDR
      EnableDnsHostnames: true
      EnableDnsSupport: true
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-vpc"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -----------------------
  # Internet Gateway
  # -----------------------
  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-igw"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -----------------------
  # Connect Internet Gateway to VPC
  # -----------------------
  AttachGateway:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway

  # -----------------------
  # Public Subnets
  # -----------------------
  PublicSubnet1:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: !Ref PublicSubnet1CIDR
      MapPublicIpOnLaunch: true
      AvailabilityZone: !Select
        - 0
        - Fn::GetAZs: !Ref AWS::Region
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-public-subnet-1"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName
        - Key: Type
          Value: public

  PublicSubnet2:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: !Ref PublicSubnet2CIDR
      MapPublicIpOnLaunch: true
      AvailabilityZone: !Select
        - 1
        - Fn::GetAZs: !Ref AWS::Region
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-public-subnet-2"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName
        - Key: Type
          Value: public

  # -----------------------
  # Private Subnets
  # -----------------------
  PrivateSubnet1:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: !Ref PrivateSubnet1CIDR
      MapPublicIpOnLaunch: false
      AvailabilityZone: !Select
        - 0
        - Fn::GetAZs: !Ref AWS::Region
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-private-subnet-1"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName
        - Key: Type
          Value: private
        - Key: Purpose
          Value: ecs

  PrivateSubnet2:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: !Ref PrivateSubnet2CIDR
      MapPublicIpOnLaunch: false
      AvailabilityZone: !Select
        - 1
        - Fn::GetAZs: !Ref AWS::Region
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-private-subnet-2"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName
        - Key: Type
          Value: private
        - Key: Purpose
          Value: ecs

  PrivateSubnet3:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: !Ref PrivateSubnet3CIDR
      MapPublicIpOnLaunch: false
      AvailabilityZone: !Select
        - 0
        - Fn::GetAZs: !Ref AWS::Region
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-private-subnet-3"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName
        - Key: Type
          Value: private
        - Key: Purpose
          Value: database

  PrivateSubnet4:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: !Ref PrivateSubnet4CIDR
      MapPublicIpOnLaunch: false
      AvailabilityZone: !Select
        - 1
        - Fn::GetAZs: !Ref AWS::Region
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-private-subnet-4"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName
        - Key: Type
          Value: private
        - Key: Purpose
          Value: database

  # -----------------------
  # NAT Gateway (for Private Subnets)
  # -----------------------
  NatEIP:
    Type: AWS::EC2::EIP
    DependsOn: AttachGateway
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-nat-eip"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  NatGateway:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId: !GetAtt NatEIP.AllocationId
      SubnetId: !Ref PublicSubnet1
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-ngw"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -----------------------
  # Public Route Table
  # -----------------------
  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref VPC
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-public-rtb"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  PublicRoute:
    Type: AWS::EC2::Route
    DependsOn: AttachGateway
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway

  PublicSubnet1RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnet1
      RouteTableId: !Ref PublicRouteTable

  PublicSubnet2RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnet2
      RouteTableId: !Ref PublicRouteTable

  # -----------------------
  # Private Route Table
  # -----------------------
  PrivateRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref VPC
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-private-rtb"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  PrivateRoute:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId: !Ref NatGateway

  PrivateSubnet1RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PrivateSubnet1
      RouteTableId: !Ref PrivateRouteTable

  PrivateSubnet2RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PrivateSubnet2
      RouteTableId: !Ref PrivateRouteTable

  PrivateSubnet3RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PrivateSubnet3
      RouteTableId: !Ref PrivateRouteTable

  PrivateSubnet4RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PrivateSubnet4
      RouteTableId: !Ref PrivateRouteTable

  # -----------------------
  # S3 Gateway Endpoint (for cost optimization)
  # -----------------------
  S3Endpoint:
    Type: AWS::EC2::VPCEndpoint
    Properties:
      VpcId: !Ref VPC
      ServiceName: !Sub "com.amazonaws.${AWS::Region}.s3"
      VpcEndpointType: Gateway
      RouteTableIds:
        - !Ref PrivateRouteTable
      PolicyDocument:
        Statement:
          - Effect: Allow
            Principal: '*'
            Action:
              - s3:GetObject
              - s3:PutObject
              - s3:ListBucket
            Resource: '*'
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-s3-endpoint"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------
  # Service Discovery Namespace (Private)
  # -------------------------------
  ServiceDiscoveryNamespace:
    Type: AWS::ServiceDiscovery::PrivateDnsNamespace
    Properties:
      Name: !Sub "${ProjectName}.internal"
      Vpc: !Ref VPC
      Description: !Sub "Private DNS namespace for ${ProjectName}"
    DependsOn: VPC

  # -------------------------------------------------
  # ALB Security Group
  # -------------------------------------------------
  ALBSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for Application Load Balancer
      VpcId: !Ref VPC
      SecurityGroupIngress:
        # Allow HTTP from Internet
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: !Ref AllowedHTTPCIDR
          Description: Allow HTTP from Internet
        # Allow HTTPS from Internet
        - IpProtocol: tcp
          FromPort: 443
          ToPort: 443
          CidrIp: !Ref AllowedHTTPCIDR
          Description: Allow HTTPS from Internet
      SecurityGroupEgress:
        # Allow all outbound traffic
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-alb-sg"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------------------------
  # Gateway Security Group
  # -------------------------------------------------
  GatewaySecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for Gateway service
      VpcId: !Ref VPC
      SecurityGroupIngress:
        # Allow HTTP from ALB
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          SourceSecurityGroupId: !Ref ALBSecurityGroup
          Description: Allow HTTP from ALB
      SecurityGroupEgress:
        # Allow all outbound traffic
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-gateway-sg"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------------------------
  # Bastion Security Group
  # -------------------------------------------------
  BastionSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for Bastion host
      VpcId: !Ref VPC
      SecurityGroupIngress:
        # Allow SSH from specified CIDR
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: !Ref AllowedSSHCIDR
          Description: Allow SSH from specified CIDR
      SecurityGroupEgress:
        # Allow all outbound traffic
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-bastion-sg"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------------------------
  # Base Security Group (for ECS base services)
  # -------------------------------------------------
  BaseSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for ECS base services (Eureka, Config Server, etc.)
      VpcId: !Ref VPC
      SecurityGroupIngress:
        # Allow HTTP from Gateway
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          SourceSecurityGroupId: !Ref GatewaySecurityGroup
          Description: Allow HTTP from Gateway
        # Allow Eureka port from Gateway
        - IpProtocol: tcp
          FromPort: 8761
          ToPort: 8761
          SourceSecurityGroupId: !Ref GatewaySecurityGroup
          Description: Allow Eureka from Gateway
        # Allow Config Server port from Gateway
        - IpProtocol: tcp
          FromPort: 8888
          ToPort: 8888
          SourceSecurityGroupId: !Ref GatewaySecurityGroup
          Description: Allow Config Server from Gateway
        # Allow RabbitMQ port from Gateway
        - IpProtocol: tcp
          FromPort: 5672
          ToPort: 5672
          SourceSecurityGroupId: !Ref GatewaySecurityGroup
          Description: Allow RabbitMQ from Gateway
      SecurityGroupEgress:
        # Allow all outbound traffic
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-base-sg"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------------------------
  # Business Security Group (for business services)
  # -------------------------------------------------
  BusinessSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for business services
      VpcId: !Ref VPC
      SecurityGroupIngress:
        # Allow business service ports from Gateway
        # Adjust port range based on your actual service ports
        - IpProtocol: tcp
          FromPort: 8080
          ToPort: 8090
          SourceSecurityGroupId: !Ref GatewaySecurityGroup
          Description: Allow business services from Gateway
      SecurityGroupEgress:
        # Allow all outbound traffic
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-business-sg"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------------------------
  # Database Security Group
  # -------------------------------------------------
  DatabaseSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for MySQL database
      VpcId: !Ref VPC
      SecurityGroupIngress:
        # Allow MySQL from Bastion
        - IpProtocol: tcp
          FromPort: 3306
          ToPort: 3306
          SourceSecurityGroupId: !Ref BastionSecurityGroup
          Description: Allow MySQL from Bastion
        # Allow MySQL from Base services (if needed)
        - IpProtocol: tcp
          FromPort: 3306
          ToPort: 3306
          SourceSecurityGroupId: !Ref BaseSecurityGroup
          Description: Allow MySQL from Base services
        # Allow MySQL from Business services
        - IpProtocol: tcp
          FromPort: 3306
          ToPort: 3306
          SourceSecurityGroupId: !Ref BusinessSecurityGroup
          Description: Allow MySQL from Business services
      SecurityGroupEgress:
        # Allow all outbound traffic
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-database-sg"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------------------------
  # Gateway Target Group
  # -------------------------------------------------
  GatewayTargetGroup:
    Type: AWS::ElasticLoadBalancingV2::TargetGroup
    Properties:
      Name: !Sub "${ProjectName}-gateway-tg"
      Port: 80
      Protocol: HTTP
      VpcId: !Ref VPC
      TargetType: ip
      HealthCheckPath: !Ref HealthCheckPath
      HealthCheckProtocol: HTTP
      HealthCheckIntervalSeconds: 30
      HealthCheckTimeoutSeconds: 5
      HealthyThresholdCount: 2
      UnhealthyThresholdCount: 3
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-gateway-tg"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------------------------
  # Application Load Balancer
  # -------------------------------------------------
  ApplicationLoadBalancer:
    Type: AWS::ElasticLoadBalancingV2::LoadBalancer
    Properties:
      Name: !Sub "${ProjectName}-alb"
      Scheme: internet-facing
      Type: application
      IpAddressType: ipv4
      Subnets: [!Ref PublicSubnet1, !Ref PublicSubnet2]
      SecurityGroups:
        - !Ref ALBSecurityGroup
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-alb"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # -------------------------------------------------
  # HTTPS Listener (conditional)
  # -------------------------------------------------
  ALBListenerHTTPS:
    Type: AWS::ElasticLoadBalancingV2::Listener
    Condition: EnableHTTPSListener
    Properties:
      LoadBalancerArn: !Ref ApplicationLoadBalancer
      Port: 443
      Protocol: HTTPS
      Certificates:
        - CertificateArn: !Ref SSLCertificateArn
      DefaultActions:
        - Type: forward
          TargetGroupArn: !Ref GatewayTargetGroup

  # -------------------------------------------------
  # HTTP Listener
  # -------------------------------------------------
  ALBListenerHTTP:
    Type: AWS::ElasticLoadBalancingV2::Listener
    Properties:
      LoadBalancerArn: !Ref ApplicationLoadBalancer
      Port: 80
      Protocol: HTTP
      DefaultActions: !If
        - EnableHTTPSListener
        - - Type: redirect
            RedirectConfig:
              Protocol: HTTPS
              Port: "443"
              StatusCode: HTTP_301
        - - Type: forward
            TargetGroupArn: !Ref GatewayTargetGroup

  # -------------------------------------------------
  # VPC Flow Logs (for network monitoring)
  # -------------------------------------------------
  FlowLogsRole:
    Type: AWS::IAM::Role
    Condition: CreateFlowLogs
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: vpc-flow-logs.amazonaws.com
            Action: sts:AssumeRole
      Policies:
        - PolicyName: VPCFlowLogsDeliveryPolicy
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                  - logs:DescribeLogGroups
                  - logs:DescribeLogStreams
                Resource: '*'
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-flow-logs-role"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  FlowLogsGroup:
    Type: AWS::Logs::LogGroup
    Condition: CreateFlowLogs
    Properties:
      LogGroupName: !Sub "/aws/vpc/${ProjectName}"
      RetentionInDays: !If
        - IsProd
        - 30
        - 7
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-flow-logs"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  FlowLogs:
    Type: AWS::EC2::FlowLog
    Condition: CreateFlowLogs
    Properties:
      ResourceType: VPC
      ResourceId: !Ref VPC
      TrafficType: ALL
      LogDestinationType: cloud-watch-logs
      LogDestination: !GetAtt FlowLogsGroup.Arn
      DeliverLogsPermissionArn: !GetAtt FlowLogsRole.Arn

Outputs:
  VPCId:
    Description: VPC ID
    Value: !Ref VPC
    Export:
      Name: !Sub "${ProjectName}-vpc-id"

  PrivateDnsNamespaceId:
    Description: Private DNS Namespace ID
    Value: !Ref ServiceDiscoveryNamespace
    Export:
      Name: !Sub "${ProjectName}-servicediscovery-namespace-id"

  PublicSubnets:
    Description: Public Subnet IDs (comma-separated)
    Value: !Join [",", [!Ref PublicSubnet1, !Ref PublicSubnet2]]
    Export:
      Name: !Sub "${ProjectName}-public-subnets"

  PublicSubnet1:
    Description: Public Subnet ID 1
    Value: !Ref PublicSubnet1
    Export:
      Name: !Sub "${ProjectName}-public-subnet-1"

  PublicSubnet2:
    Description: Public Subnet ID 2
    Value: !Ref PublicSubnet2
    Export:
      Name: !Sub "${ProjectName}-public-subnet-2"

  ECSPrivateSubnets:
    Description: Private Subnet IDs for ECS (comma-separated)
    Value: !Join [",", [!Ref PrivateSubnet1, !Ref PrivateSubnet2]]
    Export:
      Name: !Sub "${ProjectName}-ecs-private-subnets"

  DBPrivateSubnets:
    Description: Private Subnet IDs for Database (comma-separated)
    Value: !Join [",", [!Ref PrivateSubnet3, !Ref PrivateSubnet4]]
    Export:
      Name: !Sub "${ProjectName}-db-private-subnets"

  DBPrivateSubnet3:
    Description: Private Subnet3 ID
    Value: !Ref PrivateSubnet3
    Export:
      Name: !Sub "${ProjectName}-db-private-subnet-3"

  DBPrivateSubnet4:
    Description: Private Subnet4 ID
    Value: !Ref PrivateSubnet4
    Export:
      Name: !Sub "${ProjectName}-db-private-subnet-4"

  InternetGatewayId:
    Description: Internet Gateway ID
    Value: !Ref InternetGateway
    Export:
      Name: !Sub "${ProjectName}-igw"

  NatGatewayId:
    Description: NAT Gateway ID
    Value: !Ref NatGateway
    Export:
      Name: !Sub "${ProjectName}-ngw"

  S3EndpointId:
    Description: S3 VPC Endpoint ID
    Value: !Ref S3Endpoint
    Export:
      Name: !Sub "${ProjectName}-s3-endpoint"

  ALBArn:
    Description: Application Load Balancer ARN
    Value: !Ref ApplicationLoadBalancer
    Export:
      Name: !Sub "${ProjectName}-alb"

  ALBListenerArn:
    Description: HTTP Listener ARN
    Value: !Ref ALBListenerHTTP
    Export:
      Name: !Sub "${ProjectName}-alb-arn"

  ALBUrl:
    Description: Public DNS name for ALB
    Value: !GetAtt ApplicationLoadBalancer.DNSName
    Export:
      Name: !Sub "${ProjectName}-alb-url"

  GatewayTargetGroupArn:
    Description: Target Group ARN for Gateway Service
    Value: !Ref GatewayTargetGroup
    Export:
      Name: !Sub "${ProjectName}-gateway-tg"

  ALBSecurityGroupId:
    Description: Security Group ID for ALB
    Value: !Ref ALBSecurityGroup
    Export:
      Name: !Sub "${ProjectName}-alb-sg"

  BastionSecurityGroupId:
    Description: Security Group ID for Bastion
    Value: !Ref BastionSecurityGroup
    Export:
      Name: !Sub "${ProjectName}-bastion-sg"

  BaseSecurityGroupId:
    Description: Security Group ID for Base services
    Value: !Ref BaseSecurityGroup
    Export:
      Name: !Sub "${ProjectName}-base-sg"

  GatewaySecurityGroupId:
    Description: Security Group ID for Gateway
    Value: !Ref GatewaySecurityGroup
    Export:
      Name: !Sub "${ProjectName}-gateway-sg"

  BusinessSecurityGroupId:
    Description: Security Group ID for Business services
    Value: !Ref BusinessSecurityGroup
    Export:
      Name: !Sub "${ProjectName}-business-sg"

  DatabaseSecurityGroupId:
    Description: Security Group ID for Database
    Value: !Ref DatabaseSecurityGroup
    Export:
      Name: !Sub "${ProjectName}-database-sg"
